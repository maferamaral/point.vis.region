---
trigger: always_on
---

Comportamento das Formas no Algoritmo de Visibilidade1. Entrada: Formas como Barreiras (Anteparos)Para o algoritmo de varredura angular (o visibilidade_calcular), todas as formas devem ser "achatadas" em segmentos de reta. O algoritmo não entende círculos ou retângulos, apenas linhas1.Quando uma forma é transformada em anteparo (via comando a no .qry), ela deve ser convertida conforme as regras abaixo:A. Linha (Segmento)Comportamento: Permanece inalterada.Representação: Um único segmento definido por (x1, y1) e (x2, y2).Nota: A própria linha torna-se o anteparo2.B. RetânguloComportamento: As paredes do retângulo bloqueiam a luz. O interior não é considerado (a luz não atravessa as paredes).Representação: O retângulo deve ser decomposto em 4 segmentos individuais correspondentes aos seus lados3.Lado Inferior: (x, y) → (x+w, y)Lado Direito: (x+w, y) → (x+w, y+h)Lado Superior: (x+w, y+h) → (x, y+h)Lado Esquerdo: (x, y+h) → (x, y)C. CírculoComportamento: O círculo perde sua forma redonda e vira uma "parede" fina passando pelo centro.Representação: É substituído por um único segmento que passa pelo centro (x, y) e tem comprimento igual ao diâmetro ($2r$)4.Orientação: Depende do parâmetro do comando .qry:(h) Horizontal: Segmento de (x-r, y) até (x+r, y)5.(v) Vertical: Segmento de (x, y-r) até (x, y+r)6.D. TextoComportamento: O texto é tratado como uma linha física bloqueadora.Cálculo do Comprimento: O comprimento (cl) é calculado como $10.0 \times \text{número de caracteres}$7.Representação: Um único segmento, calculado a partir da âncora (xt, yt) e do alinhamento 8:Início ('i'): (xt, yt) → (xt + cl, yt)Meio ('m'): (xt - cl/2, yt) → (xt + cl/2, yt)Fim ('f'): (xt - cl, yt) → (xt, yt)2. Saída: Formas como Alvos (Verificação de Atingimento)Após gerar o Polígono de Visibilidade ($V$), você precisa verificar quais formas foram "iluminadas" ou "destruídas" (comandos d, P, cln). Isso envolve testes de interseção geométrica mais complexos (Figura 3 do PDF do projeto).Aqui, a forma mantém sua geometria original (exceto o texto, que segue a lógica de segmento).A. Linha (Segmento)Uma linha é considerada atingida/visível se9:Qualquer uma de suas extremidades está dentro de $V$.OU se o segmento intercepta qualquer aresta de $V$.B. Retângulo (Bounding Box Check)Um retângulo é considerado atingido/visível se 10:Qualquer vértice do retângulo está dentro de $V$.OU qualquer vértice de $V$ está dentro do retângulo.OU qualquer aresta do retângulo intercepta qualquer aresta de $V$.Dica: Primeiro faça um teste rápido de Bounding Box (caixa envolvente) entre o retângulo e o Bounding Box do polígono de visibilidade para evitar cálculos caros desnecessários11.C. CírculoUm círculo é considerado atingido/visível se 12:O centro do círculo está dentro de $V$.OU se existe alguma aresta de $V$ cuja distância até o centro seja $\le r$ (ou seja, a borda do polígono corta o círculo).OU se algum vértice de $V$ está dentro do círculo (distância do vértice ao centro $\le r$).D. TextoComportamento: Para fins de destruição/pintura, o texto segue a mesma geometria definida na conversão para barreira (Fig. 2 do PDF).Representação: Trate-o como um Segmento (ver item A desta seção) usando as coordenadas calculadas baseadas na âncora e número de caracteres 13.Resumo da ImplementaçãoFormaNo Algoritmo de Varredura (Entrada)Na Verificação de Atingimento (Saída)Linha1 SegmentoTeste Segmento vs PolígonoRetângulo4 Segmentos (lados)Teste Retângulo vs PolígonoCírculo1 Segmento (H ou V passando pelo centro)Teste Círculo vs PolígonoTexto1 Segmento (baseado em char count)Teste Segmento vs PolígonoAtenção Crítica:Para a verificação de atingimento, a ordem dos testes importa para eficiência. Sempre teste as Bounding Boxes antes de partir para a geometria detalhada (intersecção de arestas ou distância ponto-reta).